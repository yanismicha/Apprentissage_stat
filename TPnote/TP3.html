<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>TP3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="TP3_files/libs/clipboard/clipboard.min.js"></script>
<script src="TP3_files/libs/quarto-html/quarto.js"></script>
<script src="TP3_files/libs/quarto-html/popper.min.js"></script>
<script src="TP3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="TP3_files/libs/quarto-html/anchor.min.js"></script>
<link href="TP3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="TP3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="TP3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="TP3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="TP3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TP3</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><a href="https://github.com/yanismicha" class="btn btn-primary">Lien vers le git</a></p>
<section id="exercice-1-k-means" class="level1">
<h1><u>Exercice 1 : k-means</u></h1>
<section id="chargement-du-jeu-de-donnée" class="level2">
<h2 class="anchored" data-anchor-id="chargement-du-jeu-de-donnée">1: Chargement du jeu de donnée</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length Sepal.Width
1          5.1         3.5
2          4.9         3.0
3          4.7         3.2
4          4.6         3.1
5          5.0         3.6
6          5.4         3.9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] setosa setosa setosa setosa setosa setosa
Levels: setosa versicolor virginica</code></pre>
</div>
</div>
</section>
<section id="kmeans" class="level2">
<h2 class="anchored" data-anchor-id="kmeans">2: kmeans</h2>
<p>Les arguments obligatoires dans la fonction <span style="color: #8B0000;">kmeans</span>:</p>
<ul>
<li>x: le jeu de données sur lequel on souhaite réaliser l’algorithme</li>
<li>centers: représente le nombre de clusters que l’on souhaite représenter lors de la construction de l’algorithme</li>
</ul>
</section>
<section id="clustering" class="level2">
<h2 class="anchored" data-anchor-id="clustering">3: clustering</h2>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>clust <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(X,<span class="dv">3</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(X,y)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>cluster<span class="ot">&lt;-</span> <span class="fu">factor</span>(clust<span class="sc">$</span>cluster)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers), </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width), </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkred"</span>,<span class="at">size =</span> <span class="dv">6</span>,<span class="at">shape=</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="nstart" class="level2">
<h2 class="anchored" data-anchor-id="nstart">4:nstart</h2>
<p>L’argument <strong>nstart</strong> permet de spécifier le nombre de fois que l’algorithme va itérer avec différentes initialisations aléatoires des centroïdes.<br>
Il permet donc avec une valeur plus élevé d’optimiser l’algorithme des kmeans en réduisant l’impact de l’aléa du choix d’initialisation de nos centroïdes.<br>
Exemple avec k=5:</p>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">20</span>)){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  clust <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(X,<span class="dv">5</span>,<span class="at">nstart =</span> i)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>cluster<span class="ot">&lt;-</span> <span class="fu">factor</span>(clust<span class="sc">$</span>cluster)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers), </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width), </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"darkred"</span>,<span class="at">size =</span> <span class="dv">6</span>,<span class="at">shape=</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">label =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"nstart="</span>,i)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">5</span> <span class="sc">|</span> i <span class="sc">==</span> <span class="dv">20</span>) {</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    fig <span class="ot">&lt;-</span> fig <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(<span class="st">"fig"</span>, i), fig)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(fig1, fig5, fig10, fig20, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On peut voir qu’avec une seule itération, les clusters sont totalements différents qu’avec 5,10 et 20 itérations.<br>
Cela est dû comme expliqué précedemment au choix aléatoire des centroïdes à l’initialisation de l’algorithme. Entre 10 et 20 itérations, on peut observer des clusters quasiment à l’identique preuve que cela à permis de réduire cet aléa.<br>
On peut lier cet argument à <strong>iter.max</strong> qui permet de spécifier le nombre d’itération de chaque algorithme lancé avant l’arrêt de celui-çi.</p>
</section>
<section id="critère-de-qualité-de-clustering" class="level2">
<h2 class="anchored" data-anchor-id="critère-de-qualité-de-clustering">5: critère de qualité de clustering</h2>
<p>Le critère le plus connu permettant de juger la qualité d’un clustering est l’inertie. L’inertie mesure la dispersion des points de données par rapport à leurs centres de cluster. Plus l’inertie est faible, plus les clusters sont compacts et mieux le clustering est considéré. Autrement dit l’objectif est de minimiser la variance intra-cluster et maximiser la variance inter-cluster.<br>
Deux autres scores peuvent être intéréssant à utiliser:</p>
<ul>
<li>le score <strong>silhouette</strong>: <span class="math display">\[
s_i=\frac{b_i-a_i}{max(b_i-a_i)}\\
\]</span></li>
</ul>
<p>Où <span class="math inline">\(a_i\)</span> est la distance moyenne du point avec tout les autres points dans le même cluster et où <span class="math inline">\(b_i\)</span> est la distance moyenne du point considéré avec tout les points du cluster le plus proche.<br>
- le score <strong>gap statistic</strong> qui utilise l’inertie et la compare à celles correspondants à des ensembles de données aléatoires. Il s’agit de la différence entre la valeur de l’inertie observée pour le clustering réel et la valeur moyenne de l’inertie pour les ensembles de données aléatoires. Plus cette différence est grande, plus le nombre de clusters est jugé approprié.</p>
Visualisation de ces scores:
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ONC1 <span class="ot">&lt;-</span><span class="fu">fviz_nbclust</span>(data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)], <span class="at">FUNcluster =</span> kmeans, <span class="at">method =</span> <span class="st">"silhouette"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Score:Silhouette"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ONC2 <span class="ot">&lt;-</span> <span class="fu">fviz_nbclust</span>(data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)], <span class="at">FUNcluster =</span> kmeans, <span class="at">method =</span> <span class="st">"wss"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Score:Inertie"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>ONC3 <span class="ot">&lt;-</span> <span class="fu">fviz_nbclust</span>(data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)], <span class="at">FUNcluster =</span> kmeans, <span class="at">method =</span> <span class="st">"gap_stat"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Score:Gap_stat"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>(ONC1<span class="sc">+</span>ONC2)<span class="sc">/</span>ONC3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On voit qu’avec la technique du coude pour l’inertie et l’optimisation du gap_stat, on retrouve le même nombre de clusters optimaux: 3.<br>
En revanche le score silhouette donne une légère préférence pour deux clusters.<br>
Le choix de 3 clusters est plus que raisonnable pour la simple et bonne raison que notre jeu de données concerne 3 variétés de plantes différentes.</p>
</section>
<section id="taux-dagréement" class="level2">
<h2 class="anchored" data-anchor-id="taux-dagréement">6 Taux d’agréement</h2>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>clust <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(X,<span class="at">centers =</span> <span class="dv">3</span>,<span class="at">nstart =</span> <span class="dv">10</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">as.character</span>(clust<span class="sc">$</span>cluster)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>cont <span class="ot">&lt;-</span> <span class="fu">table</span>(data<span class="sc">$</span>y,data<span class="sc">$</span>cluster)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(cont)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir une palette de couleurs pour la variable y (catégorie)</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"setosa"</span><span class="ot">=</span><span class="st">"darkred"</span>,<span class="st">"versicolor"</span><span class="ot">=</span><span class="st">"darkorange"</span>,<span class="st">"virginica"</span><span class="ot">=</span><span class="st">"steelblue"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisation des clusters avec fviz_cluster</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fviz_cluster</span>(<span class="at">object =</span> clust, X, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">stand =</span> <span class="cn">FALSE</span>, <span class="at">show.clust.cent =</span> <span class="cn">FALSE</span>, <span class="at">shape =</span> <span class="dv">16</span>,<span class="at">ellipse.alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ajout des points colorés par y</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> <span class="fu">factor</span>(y)),<span class="at">shape=</span><span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Suppression de la légende pour les clusters</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors)<span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># titre</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"kmeans 3 clusters avec taux d'agréement"</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">setosa</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">versicolor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">virginica</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">32</td>
</tr>
</tbody>
</table>


</div>
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On peut voir sur ce graphique que le cluster1 représente parfaitement les setosa tandis que pour les deux autres clusters l’algorithme a eu plus de mal à les dissocier.</p>
</section>
<section id="introduction-de-nouvelles-données" class="level2">
<h2 class="anchored" data-anchor-id="introduction-de-nouvelles-données">7: Introduction de nouvelles données</h2>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>new_clust <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(<span class="fu">rbind</span>(X, X.test), <span class="dv">3</span>,<span class="at">nstart =</span> <span class="dv">10</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="fu">fviz_cluster</span>(<span class="at">object =</span> clust, X, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">stand =</span> <span class="cn">FALSE</span>, <span class="at">show.clust.cent =</span> <span class="cn">FALSE</span>, <span class="at">shape =</span> <span class="dv">16</span>,<span class="at">ellipse.alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span><span class="fu">data.frame</span>(X.test),<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width),<span class="at">shape=</span><span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span> <span class="st">"Visualisation des nouveaux points"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="fu">fviz_cluster</span>(<span class="at">object =</span> new_clust, <span class="fu">rbind</span>(X,X.test), <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">stand =</span> <span class="cn">FALSE</span>, <span class="at">show.clust.cent =</span> <span class="cn">FALSE</span>, <span class="at">shape =</span> <span class="dv">16</span>,<span class="at">ellipse.alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span><span class="fu">data.frame</span>(X.test),<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width),<span class="at">shape=</span><span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span> <span class="st">"Insertion des nouveaux points dans les clusters"</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>f1<span class="sc">/</span>f2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="exercice-2-clustering-et-formes" class="level1">
<h1><u>Exercice 2 : Clustering et formes</u></h1>
<section id="chargement-des-jeux-de-donées" class="level2">
<h2 class="anchored" data-anchor-id="chargement-des-jeux-de-donées">Chargement des jeux de donées</h2>
</section>
<section id="aggregation" class="level2">
<h2 class="anchored" data-anchor-id="aggregation">Aggregation</h2>
<section id="cah" class="level3">
<h3 class="anchored" data-anchor-id="cah">CAH</h3>
AU vu du jeu de données on choisis k=7 clusters.<br>
On commence par utiliser la classification ascendante hiérachique pour tenter de discriminer les points en fonction des clusters attendus.<br>
Pour ce qui est des paramètres, après une pré-séléction intuituive et de l’essai-erreur, on choisis de garder la distance <strong>euclidienne</strong> et d’utiliser la méthode de <strong>Ward</strong> pour la production du dendogramme.<br>
Nous obtenons les clusters suivants:
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>hclust <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(Aggregation),<span class="at">method =</span> <span class="st">"ward.D"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_dend</span>(hclust,<span class="at">repel =</span> <span class="cn">TRUE</span>,<span class="at">k =</span> <span class="dv">7</span>,<span class="at">cex =</span> <span class="fl">0.5</span>,<span class="at">color_labels_by_k =</span> <span class="cn">FALSE</span>, <span class="at">rect =</span> <span class="cn">TRUE</span>)<span class="sc">+</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span>  <span class="st">"Dendogramme"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hclust, <span class="at">k =</span> <span class="dv">7</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>Aggregation<span class="sc">$</span>cluster <span class="ot">&lt;-</span> clusters</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Aggregation, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> <span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"hclust"</span>)<span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-16_3109b0ae854b7b3300c5014f5b2a83f4">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>L’algorithme arrive à retrouver les clusters les plus évidents mais se trompe sur les clusters 2/3/4.</p>
</section>
<section id="kmeans-kcentroïdes-vs-kmedoïdes" class="level3">
<h3 class="anchored" data-anchor-id="kmeans-kcentroïdes-vs-kmedoïdes">Kmeans: Kcentroïdes vs Kmedoïdes</h3>
Pour tenter de résoudre cette erreur de clustering avec les kmeans, nous comparons les Kcentroïdes vs Kmedoïdes avec une intuition qu’avec les Kcentroïdes, le problème ne sera pas résolu.<br>
Pour les paramètres, nous gardons bien evidemment k=7, et nous utilisons nstart=10 pour avoir une stabilité du résultat final:
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>clust <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(Aggregation,<span class="dv">7</span>,<span class="at">nstart=</span> <span class="dv">10</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>Aggregation<span class="sc">$</span>cluster<span class="ot">&lt;-</span> <span class="fu">factor</span>(clust<span class="sc">$</span>cluster)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>centroide <span class="ot">&lt;-</span><span class="fu">ggplot</span>(Aggregation, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers), </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2), </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkred"</span>,<span class="at">size =</span> <span class="dv">6</span>,<span class="at">shape=</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Kmeans avec centroïdes:"</span>)<span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>clust<span class="ot">&lt;-</span> <span class="fu">pam</span>(Aggregation,<span class="dv">7</span>,<span class="at">stand =</span> <span class="cn">TRUE</span>,<span class="at">nstart =</span> <span class="dv">10</span>)  </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>Aggregation<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(clust<span class="sc">$</span>clustering)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>medoide <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Aggregation, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>medoids), </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2), </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkred"</span>,<span class="at">size =</span> <span class="dv">6</span>,<span class="at">shape=</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>medoids),</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Kmeans avec medoïdes:"</span>)<span class="sc">+</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>centroide<span class="sc">/</span>medoide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-18_82e4e27e6c6febeae03c952349cc767a">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>LA différence entre utilisation des k-centroïdes et des kmedoïdes reste assez mineur, le cluster 3 est séparé en deux avec les k-medoïdes mais n’est tout de même pas bien considéré.</p>
</section>
<section id="kmeans-clustering-spectral" class="level3">
<h3 class="anchored" data-anchor-id="kmeans-clustering-spectral">kmeans clustering spectral</h3>
<p>Afin de permettre au <code>kmeans</code>de mieux performer, nous allons transformer nos données en les segmentant à l’aide du clustering spectral. Il s’agit d’un algorithme de partitionnement des données reposant sur la théorie spectrale des graphes et l’algèbre linéaire.<br>
L’idée est de segmenter un graphe en plusieurs petits groupes ayant des valeurs similaires ou proches.</p>
<section id="algorithme-de-clustering-spectral" class="level4">
<h4 class="anchored" data-anchor-id="algorithme-de-clustering-spectral"><u>Algorithme de Clustering Spectral</u></h4>
<p>Données : Ensemble de points <span class="math inline">\(S = \{s_1, \ldots, s_n\}\)</span> dans <span class="math inline">\(\mathbb{R}^l\)</span>, nombre de clusters <span class="math inline">\(k\)</span></p>
<ol type="1">
<li><strong>Formation de la matrice d’affinité</strong> :
<ol type="a">
<li>Calculer la matrice d’affinité <span class="math inline">\(A\)</span> selon <span class="math inline">\(A_{ij} = \exp\left(-\frac{{||s_i - s_j||^2}}{{2 \sigma^2}}\right)\)</span></li>
</ol></li>
<li><strong>Construction de la matrice de degré et de la matrice Laplacienne normalisée</strong> :
<ol type="a">
<li>Calculer la matrice diagonale <span class="math inline">\(D\)</span> où <span class="math inline">\(D_{ii}\)</span> est la somme de la <span class="math inline">\(i\)</span>-ème ligne de <span class="math inline">\(A\)</span></li>
<li>Construire la matrice <span class="math inline">\(L = D^{-1/2} A D^{-1/2}\)</span></li>
</ol></li>
<li><strong>Calcul des vecteurs propres et formation de la matrice <span class="math inline">\(X\)</span></strong> :
<ol type="a">
<li>Trouver les <span class="math inline">\(k\)</span> plus grands vecteurs propres de <span class="math inline">\(L\)</span></li>
<li>Assurer l’orthogonalité des vecteurs propres en cas de valeurs propres répétées</li>
<li>Former la matrice <span class="math inline">\(X = [x_1, x_2, \ldots, x_k] \in \mathbb{R}^{n \times k}\)</span> en empilant les vecteurs propres</li>
</ol></li>
<li><strong>Formation de la matrice <span class="math inline">\(Y\)</span></strong> :
<ol type="a">
<li>Former la matrice <span class="math inline">\(Y\)</span> à partir de <span class="math inline">\(X\)</span> en normalisant chaque ligne de <span class="math inline">\(X\)</span> pour avoir une longueur unitaire : <span class="math inline">\(Y_{ij} = \frac{{X_{ij}}}{{\sqrt{\sum_j (X_{ij})^2}}}\)</span></li>
</ol></li>
<li><strong>Clustering des lignes de <span class="math inline">\(Y\)</span> via k-means</strong> :
<ol type="a">
<li>Utiliser k-means pour regrouper les lignes de <span class="math inline">\(Y\)</span> en <span class="math inline">\(k\)</span> clusters</li>
</ol></li>
<li><strong>Assignation des points d’origine aux clusters</strong> :
<ol type="a">
<li>Assigner chaque point d’origine <span class="math inline">\(s_i\)</span> au cluster <span class="math inline">\(j\)</span> si la ligne <span class="math inline">\(i\)</span> de <span class="math inline">\(Y\)</span> a été assignée au cluster <span class="math inline">\(j\)</span></li>
</ol></li>
</ol>
On applique cet algorithme sur notre jeu de données,avec comme clusters <span class="math inline">\(k=7\)</span> et comme ecart-type<br> <span class="math inline">\(\sigma\)</span>=1:
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>euclidean_distance_squared <span class="ot">&lt;-</span> <span class="cf">function</span>(si, sj) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>((si <span class="sc">-</span> sj)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>spectral_clust<span class="ot">&lt;-</span> <span class="cf">function</span>(data,k,sigma){</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> n,<span class="at">ncol=</span>n)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i <span class="sc">!=</span> j){</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        distance_squared <span class="ot">&lt;-</span> <span class="fu">euclidean_distance_squared</span>(data[i, ], data[j, ])</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        A[i, j] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>distance_squared <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> sigma<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  diagonal <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(A)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  D <span class="ot">&lt;-</span> <span class="fu">diag</span>(diagonal)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">sqrt</span>(D))<span class="sc">%*%</span>A<span class="sc">%*%</span><span class="fu">solve</span>(<span class="fu">sqrt</span>(D))</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  eigen_decomp <span class="ot">&lt;-</span> <span class="fu">eigen</span>(L,<span class="at">symmetric =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">=</span> eigen_decomp<span class="sc">$</span>vectors[,<span class="dv">1</span><span class="sc">:</span>k]</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(X, <span class="dv">1</span>, <span class="cf">function</span>(row) row <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(row<span class="sc">^</span><span class="dv">2</span>))))</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(Y, <span class="at">centers =</span> k)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  cluster_labels <span class="ot">&lt;-</span> kmeans_result<span class="sc">$</span>cluster</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  original_data_clusters <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(data))</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cluster_labels)) {</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    original_data_clusters[<span class="fu">which</span>(cluster_labels <span class="sc">==</span> i)] <span class="ot">&lt;-</span> i</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(original_data_clusters)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>Aggregation<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">spectral_clust</span>(Aggregation[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="dv">7</span>,<span class="dv">1</span>))</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Aggregation, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Kmeans avec clustering spectral"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-20_f7a1b175cdd8a5d3c5f6ab512c488897">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Pour optimiser le resultat, il faudrait trouver le bon <span class="math inline">\(\sigma\)</span> qui permette une bonne répartition de nos données <br>(mais algorithme coûteux!).</p>
</section>
</section>
</section>
<section id="flame" class="level2">
<h2 class="anchored" data-anchor-id="flame">Flame</h2>
<section id="cah-1" class="level3">
<h3 class="anchored" data-anchor-id="cah-1">CAH</h3>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>hclust <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(flame),<span class="at">method =</span> <span class="st">"ward.D"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_dend</span>(hclust,<span class="at">repel =</span> <span class="cn">TRUE</span>,<span class="at">k =</span> <span class="dv">2</span>,<span class="at">cex =</span> <span class="fl">0.5</span>,<span class="at">color_labels_by_k =</span> <span class="cn">FALSE</span>, <span class="at">rect =</span> <span class="cn">TRUE</span>)<span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span>  <span class="st">"Dendogramme"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hclust, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>flame<span class="sc">$</span>cluster <span class="ot">&lt;-</span> clusters</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flame, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> <span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"hclust"</span>)<span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-22_5c036cbec2bb1b4e8e1963309f977403">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="kmeans-1" class="level3">
<h3 class="anchored" data-anchor-id="kmeans-1">Kmeans</h3>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>clust <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(flame,<span class="dv">2</span>,<span class="at">nstart =</span> <span class="dv">10</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>flame<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(clust<span class="sc">$</span>cluster)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>centroide <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(flame, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers), </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2), </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkred"</span>,<span class="at">size =</span> <span class="dv">6</span>,<span class="at">shape=</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Kmeans avec centroïdes:"</span>)<span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>clust<span class="ot">&lt;-</span> <span class="fu">pam</span>(flame,<span class="dv">2</span>,<span class="at">stand =</span> <span class="cn">TRUE</span>,<span class="at">nstart =</span> <span class="dv">10</span>)  </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>flame<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(clust<span class="sc">$</span>clustering)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>medoide <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(flame, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>medoids), </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2), </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkred"</span>,<span class="at">size =</span> <span class="dv">6</span>,<span class="at">shape=</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>medoids),</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2),</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Kmeans avec medoïdes:"</span>)<span class="sc">+</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>centroide<span class="sc">/</span>medoide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-24_9cf80819dbd14b731f954267fc0eb4a2">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="dbscan" class="level3">
<h3 class="anchored" data-anchor-id="dbscan">DBscan</h3>
<p>DBSCAN (Density-Based Spatial Clustering of Applications with Noise) est un algorithme de clustering qui identifie des zones de densité élevée dans l’espace des données, délimitant ainsi des clusters de formes arbitraires, tout en distinguant les points isolés comme du bruit.<br>
Pour cela, on observe d’abord pour chaque point, le nombre de voisins à au plus une distance de <span class="math inline">\(\epsilon\)</span> de celui-ci. Si l’observation considérée possède un certains nombre de voisins (en la comprenant) fixé au préalable, il s’agit d’une observation <strong>coeur</strong>. ON regroupe ensuite toute observation au voisinage d’une observation coeur en les considérant en un cluster. Les observations qui ne sont ni au voisinage d’une observation coeur, ni coeur elle même, sont considéré comme des outliers.<br>
Il convient alors de définir trois éléments pour cet algorithme:</p>
<ul>
<li>la métrique utilisée pour calculer les voisinages: nous utliserons la distance euclidienne implémenté par défault dans la fonction <code>knn</code>.</li>
<li>le nombre de voisins nécessaire pour constituer une observation coeur. Nous pouvons faire varier cet argument avec au départ un nombre point minimal à trois au vu de notre jeu de données (2 outliers sont facilement visible à l’oeil).</li>
<li>la distance <span class="math inline">\(\epsilon\)</span> maximum entre voisins que nous définirons en visualisant les distances pour chaque observation de son voisin le plus proche.</li>
</ul>
Pour ce dernier argument, nous allons fixer <span class="math inline">\(\epsilon\)</span> tel qu’une part “sufisamment grande” des observations aient une distance à son plus proche voisin inférieure à <span class="math inline">\(\epsilon\)</span>. Pour cela nous affichons sur un graphique les distances triés des voisins de chaque observations puis nous utilisons la méthode du coude:
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>knn_dist <span class="ot">&lt;-</span> <span class="fu">knn.dist</span>(flame[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)], k)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>knn_dist_sorted <span class="ot">&lt;-</span> <span class="fu">apply</span>(knn_dist, <span class="dv">2</span>, sort)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>elbow <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">nrow</span>(flame))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(flame)) {</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  elbow[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(knn_dist_sorted[i, <span class="dv">2</span><span class="sc">:</span>k]) <span class="sc">/</span> (k <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>epsilon_90_percent <span class="ot">&lt;-</span> <span class="fu">quantile</span>(knn_dist_sorted[, k], <span class="fl">0.9</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(flame),<span class="at">y =</span> elbow),<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">"steelblue"</span>)<span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> epsilon_90_percent, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">nrow</span>(flame)<span class="sc">-</span><span class="dv">15</span>, <span class="at">y =</span> epsilon_90_percent, </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"ε ="</span>, <span class="fu">round</span>(epsilon_90_percent, <span class="dv">2</span>)), </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Points triés"</span>) <span class="sc">+</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Elbow Criterion"</span>) <span class="sc">+</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
Avec cette méthode, on choisi un <span class="math inline">\(\epsilon\)</span> proche de 1.<br>
Il nous reste plus qu’à utiliser <code>dbscan</code> avec les arguments choisis et de visualiser graphiquement les clusters. COmme ce qui nous intéresse est d’avoir seulement 2 clusters, je n’affiche que les résultats qui ne font ressortir que deux clusters:
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>){</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  dbscan_result <span class="ot">&lt;-</span> <span class="fu">dbscan</span>(flame[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)], <span class="at">eps =</span><span class="fl">0.99</span>, <span class="at">minPts =</span> i,<span class="at">borderPoints =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  num_clusters <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(dbscan_result<span class="sc">$</span>cluster[dbscan_result<span class="sc">$</span>cluster <span class="sc">!=</span> <span class="dv">0</span>]))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(num_clusters<span class="sc">==</span><span class="dv">2</span>){</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    flame<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(dbscan_result<span class="sc">$</span>cluster)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    fig <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(flame, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"dbscan avec voisins minimum="</span>,i))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(fig)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-28_4a65807704628a72dd5acbcdc42f4887">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Les points rouges (cluster 0) sont des <strong>outliers</strong>. Avec 6 voisins minimum, l’algorithme arrive assez bien à retranscrire les deux clusters même si 6 points sont considérés outliers aux bords des deux clusters.</p>
</section>
<section id="kmeans-avec-clustering-spectral" class="level3">
<h3 class="anchored" data-anchor-id="kmeans-avec-clustering-spectral">Kmeans avec clustering spectral</h3>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>flame<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">spectral_clust</span>(flame[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flame, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-30_32414dc8461786982293d436edb9c480">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="spiral" class="level2">
<h2 class="anchored" data-anchor-id="spiral">Spiral</h2>
<section id="kmeans-avec-clustering-spectral-1" class="level3">
<h3 class="anchored" data-anchor-id="kmeans-avec-clustering-spectral-1">Kmeans avec clustering spectral</h3>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec variance = 1 et 3 clusters</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>spiral<span class="sc">$</span>cluster <span class="ot">&lt;-</span><span class="fu">factor</span>(<span class="fu">spectral_clust</span>(spiral[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spiral, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-32_c1d2653ce548f2b29455851f054b06ec">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="exercice-3-analyse-exporatoire" class="level1">
<h1><u>Exercice 3: Analyse exporatoire</u></h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>