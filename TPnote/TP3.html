<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yanis Micha">
<meta name="author" content="Andrew Hardwick">

<title>TP3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="TP3_files/libs/clipboard/clipboard.min.js"></script>
<script src="TP3_files/libs/quarto-html/quarto.js"></script>
<script src="TP3_files/libs/quarto-html/popper.min.js"></script>
<script src="TP3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="TP3_files/libs/quarto-html/anchor.min.js"></script>
<link href="TP3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="TP3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="TP3_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="TP3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="TP3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="TP3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="TP3_files/libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="TP3_files/libs/quarto-contrib/bookup_fonts_gwf-0.0/fonts-embed.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="1">
    <h2 id="toc-title">Sommaire</h2>
   
  <ul>
  <li><a href="#exercice-1-k-means" id="toc-exercice-1-k-means" class="nav-link active" data-scroll-target="#exercice-1-k-means"><span class="header-section-number">1</span> <u>Exercice 1 : k-means</u></a>
  <ul class="collapse">
  <li><a href="#chargement-du-jeu-de-donnée" id="toc-chargement-du-jeu-de-donnée" class="nav-link" data-scroll-target="#chargement-du-jeu-de-donnée"><span class="header-section-number">1.1</span> 1: Chargement du jeu de donnée</a></li>
  <li><a href="#kmeans" id="toc-kmeans" class="nav-link" data-scroll-target="#kmeans"><span class="header-section-number">1.2</span> 2: kmeans</a></li>
  <li><a href="#clustering" id="toc-clustering" class="nav-link" data-scroll-target="#clustering"><span class="header-section-number">1.3</span> 3: clustering</a></li>
  <li><a href="#nstart" id="toc-nstart" class="nav-link" data-scroll-target="#nstart"><span class="header-section-number">1.4</span> 4:nstart</a></li>
  <li><a href="#critère-de-qualité-de-clustering" id="toc-critère-de-qualité-de-clustering" class="nav-link" data-scroll-target="#critère-de-qualité-de-clustering"><span class="header-section-number">1.5</span> 5: critère de qualité de clustering</a></li>
  <li><a href="#taux-dagréement" id="toc-taux-dagréement" class="nav-link" data-scroll-target="#taux-dagréement"><span class="header-section-number">1.6</span> 6 Taux d’agréement</a></li>
  <li><a href="#introduction-de-nouvelles-données" id="toc-introduction-de-nouvelles-données" class="nav-link" data-scroll-target="#introduction-de-nouvelles-données"><span class="header-section-number">1.7</span> 7: Introduction de nouvelles données</a></li>
  </ul></li>
  <li><a href="#exercice-2-clustering-et-formes" id="toc-exercice-2-clustering-et-formes" class="nav-link" data-scroll-target="#exercice-2-clustering-et-formes"><span class="header-section-number">2</span> <u>Exercice 2 : Clustering et formes</u></a>
  <ul class="collapse">
  <li><a href="#chargement-des-jeux-de-données" id="toc-chargement-des-jeux-de-données" class="nav-link" data-scroll-target="#chargement-des-jeux-de-données"><span class="header-section-number">2.1</span> Chargement des jeux de données</a></li>
  <li><a href="#aggregation" id="toc-aggregation" class="nav-link" data-scroll-target="#aggregation"><span class="header-section-number">2.2</span> Aggregation</a>
  <ul class="collapse">
  <li><a href="#cah" id="toc-cah" class="nav-link" data-scroll-target="#cah"><span class="header-section-number">2.2.1</span> CAH</a></li>
  <li><a href="#kmeans-kcentroïdes-vs-kmedoïdes" id="toc-kmeans-kcentroïdes-vs-kmedoïdes" class="nav-link" data-scroll-target="#kmeans-kcentroïdes-vs-kmedoïdes"><span class="header-section-number">2.2.2</span> Kmeans: Kcentroïdes vs Kmedoïdes</a></li>
  <li><a href="#kmeans-clustering-spectral" id="toc-kmeans-clustering-spectral" class="nav-link" data-scroll-target="#kmeans-clustering-spectral"><span class="header-section-number">2.2.3</span> kmeans clustering spectral</a></li>
  </ul></li>
  <li><a href="#flame" id="toc-flame" class="nav-link" data-scroll-target="#flame"><span class="header-section-number">2.3</span> Flame</a>
  <ul class="collapse">
  <li><a href="#cah-1" id="toc-cah-1" class="nav-link" data-scroll-target="#cah-1"><span class="header-section-number">2.3.1</span> CAH</a></li>
  <li><a href="#kmeans-1" id="toc-kmeans-1" class="nav-link" data-scroll-target="#kmeans-1"><span class="header-section-number">2.3.2</span> Kmeans</a></li>
  <li><a href="#dbscan" id="toc-dbscan" class="nav-link" data-scroll-target="#dbscan"><span class="header-section-number">2.3.3</span> DBscan</a></li>
  <li><a href="#kmeans-avec-clustering-spectral" id="toc-kmeans-avec-clustering-spectral" class="nav-link" data-scroll-target="#kmeans-avec-clustering-spectral"><span class="header-section-number">2.3.4</span> Kmeans avec clustering spectral</a></li>
  </ul></li>
  <li><a href="#spiral" id="toc-spiral" class="nav-link" data-scroll-target="#spiral"><span class="header-section-number">2.4</span> Spiral</a>
  <ul class="collapse">
  <li><a href="#cah-2" id="toc-cah-2" class="nav-link" data-scroll-target="#cah-2"><span class="header-section-number">2.4.1</span> CAH</a></li>
  <li><a href="#kmeans-avec-clustering-spectral-1" id="toc-kmeans-avec-clustering-spectral-1" class="nav-link" data-scroll-target="#kmeans-avec-clustering-spectral-1"><span class="header-section-number">2.4.2</span> Kmeans avec clustering spectral</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#exercice-3-analyse-exporatoire" id="toc-exercice-3-analyse-exporatoire" class="nav-link" data-scroll-target="#exercice-3-analyse-exporatoire"><span class="header-section-number">3</span> <u>Exercice 3: Analyse exporatoire</u></a>
  <ul class="collapse">
  <li><a href="#représentation-des-observations" id="toc-représentation-des-observations" class="nav-link" data-scroll-target="#représentation-des-observations"><span class="header-section-number">3.1</span> 1: représentation des observations</a></li>
  <li><a href="#acp" id="toc-acp" class="nav-link" data-scroll-target="#acp"><span class="header-section-number">3.2</span> 2: ACP</a></li>
  <li><a href="#clustering-hierarchique" id="toc-clustering-hierarchique" class="nav-link" data-scroll-target="#clustering-hierarchique"><span class="header-section-number">3.3</span> 3: clustering hierarchique</a></li>
  <li><a href="#kmeans-2" id="toc-kmeans-2" class="nav-link" data-scroll-target="#kmeans-2"><span class="header-section-number">3.4</span> 4: Kmeans</a></li>
  <li><a href="#identification-inter-espèce" id="toc-identification-inter-espèce" class="nav-link" data-scroll-target="#identification-inter-espèce"><span class="header-section-number">3.5</span> 5: identification inter-espèce</a>
  <ul class="collapse">
  <li><a href="#gène-rto" id="toc-gène-rto" class="nav-link" data-scroll-target="#gène-rto"><span class="header-section-number">3.5.1</span> Gène RTO</a></li>
  <li><a href="#kmeans-3" id="toc-kmeans-3" class="nav-link" data-scroll-target="#kmeans-3"><span class="header-section-number">3.5.2</span> Kmeans</a></li>
  <li><a href="#gène-aug" id="toc-gène-aug" class="nav-link" data-scroll-target="#gène-aug"><span class="header-section-number">3.5.3</span> Gène AUG</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TP3</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Yanis Micha </p>
             <p>Andrew Hardwick </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="alert alert-secondary" role="alert">
<p><a href="https://github.com/yanismicha/Apprentissage_stat" class="alert-link" style="color:  #72afd2">Lien vers notre git</a>. Vous retrouverez l’ensemble des projets de cet UE sur ce git.</p>
</div>
<section id="exercice-1-k-means" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> <u>Exercice 1 : k-means</u></h1>
<section id="chargement-du-jeu-de-donnée" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="chargement-du-jeu-de-donnée"><span class="header-section-number">1.1</span> 1: Chargement du jeu de donnée</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length Sepal.Width
1          5.1         3.5
2          4.9         3.0
3          4.7         3.2
4          4.6         3.1
5          5.0         3.6
6          5.4         3.9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] setosa setosa setosa setosa setosa setosa
Levels: setosa versicolor virginica</code></pre>
</div>
</div>
</section>
<section id="kmeans" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="kmeans"><span class="header-section-number">1.2</span> 2: kmeans</h2>
<p>Les arguments obligatoires dans la fonction <span style="color: #8B0000;">kmeans</span>:</p>
<ul>
<li>x: le jeu de données sur lequel on souhaite réaliser l’algorithme</li>
<li>centers: représente le nombre de clusters que l’on souhaite représenter lors de la construction de l’algorithme</li>
</ul>
</section>
<section id="clustering" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="clustering"><span class="header-section-number">1.3</span> 3: clustering</h2>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>clust <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(X,<span class="dv">3</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(X,y)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>cluster<span class="ot">&lt;-</span> <span class="fu">factor</span>(clust<span class="sc">$</span>cluster)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers), </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width), </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkred"</span>,<span class="at">size =</span> <span class="dv">6</span>,<span class="at">shape=</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="nstart" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="nstart"><span class="header-section-number">1.4</span> 4:nstart</h2>
<p>L’argument <strong>nstart</strong> permet de spécifier le nombre de fois que l’algorithme va itérer avec différentes initialisations aléatoires des centroïdes.<br>
Il permet donc avec une valeur plus élevé d’optimiser l’algorithme des kmeans en réduisant l’impact de l’aléa du choix d’initialisation de nos centroïdes.<br>
Exemple avec k=5:</p>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">20</span>)){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  clust <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(X,<span class="dv">5</span>,<span class="at">nstart =</span> i)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>cluster<span class="ot">&lt;-</span> <span class="fu">factor</span>(clust<span class="sc">$</span>cluster)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  fig <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers), </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width), </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"darkred"</span>,<span class="at">size =</span> <span class="dv">6</span>,<span class="at">shape=</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">label =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"nstart="</span>,i)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">5</span> <span class="sc">|</span> i <span class="sc">==</span> <span class="dv">20</span>) {</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    fig <span class="ot">&lt;-</span> fig <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(<span class="st">"fig"</span>, i), fig)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(fig1, fig5, fig10, fig20, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On peut voir qu’avec une seule itération, les clusters sont totalements différents qu’avec 5,10 et 20 itérations.<br>
Cela est dû comme expliqué précedemment au choix aléatoire des centroïdes à l’initialisation de l’algorithme. Entre 10 et 20 itérations, on peut observer des clusters quasiment à l’identique preuve que cela à permis de réduire cet aléa.<br>
On peut lier cet argument à <strong>iter.max</strong> qui permet de spécifier le nombre d’itération de chaque algorithme lancé avant l’arrêt de celui-çi.</p>
</section>
<section id="critère-de-qualité-de-clustering" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="critère-de-qualité-de-clustering"><span class="header-section-number">1.5</span> 5: critère de qualité de clustering</h2>
<p>Le critère le plus connu permettant de juger la qualité d’un clustering est l’inertie. L’inertie mesure la dispersion des points de données par rapport à leurs centres de cluster. Plus l’inertie est faible, plus les clusters sont compacts et mieux le clustering est considéré. Autrement dit l’objectif est de minimiser la variance intra-cluster et maximiser la variance inter-cluster.<br>
Deux autres scores peuvent être intéréssant à utiliser:</p>
<ul>
<li>le score <strong>silhouette</strong>: <span class="math display">\[
s_i=\frac{b_i-a_i}{max(b_i-a_i)}\\
\]</span></li>
</ul>
<p>Où <span class="math inline">\(a_i\)</span> est la distance moyenne du point avec tout les autres points dans le même cluster et où <span class="math inline">\(b_i\)</span> est la distance moyenne du point considéré avec tout les points du cluster le plus proche.<br>
- le score <strong>gap statistic</strong> qui utilise l’inertie et la compare à celles correspondants à des ensembles de données aléatoires. Il s’agit de la différence entre la valeur de l’inertie observée pour le clustering réel et la valeur moyenne de l’inertie pour les ensembles de données aléatoires. Plus cette différence est grande, plus le nombre de clusters est jugé approprié.</p>
Visualisation de ces scores:
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ONC1 <span class="ot">&lt;-</span><span class="fu">fviz_nbclust</span>(data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)], <span class="at">FUNcluster =</span> kmeans, <span class="at">method =</span> <span class="st">"silhouette"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Score:Silhouette"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ONC2 <span class="ot">&lt;-</span> <span class="fu">fviz_nbclust</span>(data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)], <span class="at">FUNcluster =</span> kmeans, <span class="at">method =</span> <span class="st">"wss"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Score:Inertie"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>ONC3 <span class="ot">&lt;-</span> <span class="fu">fviz_nbclust</span>(data[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)], <span class="at">FUNcluster =</span> kmeans, <span class="at">method =</span> <span class="st">"gap_stat"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Score:Gap_stat"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>(ONC1<span class="sc">+</span>ONC2)<span class="sc">/</span>ONC3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On voit qu’avec la technique du coude pour l’inertie et l’optimisation du gap_stat, on retrouve le même nombre de clusters optimaux: 3.<br>
En revanche le score silhouette donne une légère préférence pour deux clusters.<br>
Le choix de 3 clusters est plus que raisonnable pour la simple et bonne raison que notre jeu de données concerne 3 variétés de plantes différentes.</p>
</section>
<section id="taux-dagréement" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="taux-dagréement"><span class="header-section-number">1.6</span> 6 Taux d’agréement</h2>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>clust <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(X,<span class="at">centers =</span> <span class="dv">3</span>,<span class="at">nstart =</span> <span class="dv">10</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">as.character</span>(clust<span class="sc">$</span>cluster)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>cont <span class="ot">&lt;-</span> <span class="fu">table</span>(data<span class="sc">$</span>y,data<span class="sc">$</span>cluster)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(cont)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir une palette de couleurs pour la variable y (catégorie)</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"setosa"</span><span class="ot">=</span><span class="st">"darkred"</span>,<span class="st">"versicolor"</span><span class="ot">=</span><span class="st">"darkorange"</span>,<span class="st">"virginica"</span><span class="ot">=</span><span class="st">"steelblue"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisation des clusters avec fviz_cluster</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fviz_cluster</span>(<span class="at">object =</span> clust, X, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">stand =</span> <span class="cn">FALSE</span>, <span class="at">show.clust.cent =</span> <span class="cn">FALSE</span>, <span class="at">shape =</span> <span class="dv">16</span>,<span class="at">ellipse.alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ajout des points colorés par y</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> <span class="fu">factor</span>(y)),<span class="at">shape=</span><span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Suppression de la légende pour les clusters</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors)<span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># titre</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"kmeans 3 clusters avec taux d'agréement"</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">setosa</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">versicolor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">virginica</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">32</td>
</tr>
</tbody>
</table>


</div>
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On peut voir sur ce graphique que le cluster1 représente parfaitement les setosa tandis que pour les deux autres clusters l’algorithme a eu plus de mal à les dissocier.</p>
</section>
<section id="introduction-de-nouvelles-données" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="introduction-de-nouvelles-données"><span class="header-section-number">1.7</span> 7: Introduction de nouvelles données</h2>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>new_clust <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(<span class="fu">rbind</span>(X, X.test), <span class="dv">3</span>,<span class="at">nstart =</span> <span class="dv">10</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="fu">fviz_cluster</span>(<span class="at">object =</span> clust, X, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">stand =</span> <span class="cn">FALSE</span>, <span class="at">show.clust.cent =</span> <span class="cn">FALSE</span>, <span class="at">shape =</span> <span class="dv">16</span>,<span class="at">ellipse.alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span><span class="fu">data.frame</span>(X.test),<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width),<span class="at">shape=</span><span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span> <span class="st">"Visualisation des nouveaux points"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="fu">fviz_cluster</span>(<span class="at">object =</span> new_clust, <span class="fu">rbind</span>(X,X.test), <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">stand =</span> <span class="cn">FALSE</span>, <span class="at">show.clust.cent =</span> <span class="cn">FALSE</span>, <span class="at">shape =</span> <span class="dv">16</span>,<span class="at">ellipse.alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span><span class="fu">data.frame</span>(X.test),<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width),<span class="at">shape=</span><span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span> <span class="st">"Insertion des nouveaux points dans les clusters"</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>f1<span class="sc">/</span>f2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="exercice-2-clustering-et-formes" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> <u>Exercice 2 : Clustering et formes</u></h1>
<section id="chargement-des-jeux-de-données" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="chargement-des-jeux-de-données"><span class="header-section-number">2.1</span> Chargement des jeux de données</h2>
</section>
<section id="aggregation" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="aggregation"><span class="header-section-number">2.2</span> Aggregation</h2>
<section id="cah" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="cah"><span class="header-section-number">2.2.1</span> CAH</h3>
Au vu du jeu de données on choisis k=7 clusters.<br>
On commence par utiliser la classification ascendante hiérachique pour tenter de discriminer les points en fonction des clusters attendus.<br>
Pour ce qui est des paramètres, après une pré-séléction intuituive et de l’essai-erreur, on choisis de garder la distance <strong>euclidienne</strong> et d’utiliser la méthode <strong>single</strong> pour la production du dendogramme.<br>
Mathématiquement, cette méthode se traduit comme la distance <span class="math inline">\(D(X,Y)\)</span> entre les clusters <span class="math inline">\(X\)</span> et <span class="math inline">\(Y\)</span>: <span class="math display">\[
D(X,Y) = \min_{x \in X, y \in Y} d(x,y)
\]</span> Nous obtenons alors les clusters suivants:
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>hclust <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(Aggregation),<span class="at">method =</span> <span class="st">"single"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_dend</span>(hclust,<span class="at">repel =</span> <span class="cn">TRUE</span>,<span class="at">k =</span> <span class="dv">7</span>,<span class="at">cex =</span> <span class="fl">0.5</span>,<span class="at">color_labels_by_k =</span> <span class="cn">FALSE</span>, <span class="at">rect =</span> <span class="cn">TRUE</span>)<span class="sc">+</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span>  <span class="st">"Dendogramme"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hclust, <span class="at">k =</span> <span class="dv">7</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>Aggregation<span class="sc">$</span>cluster <span class="ot">&lt;-</span> clusters</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Aggregation, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> <span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"CLustering avec Hclust"</span>)<span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(Aggregation<span class="sc">$</span>cluster,Aggregation<span class="sc">$</span>V3)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>pourcentages <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(<span class="fu">unique</span>(Aggregation<span class="sc">$</span>cluster))) <span class="co"># vecteur pour stocker les pourcentages</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(Aggregation<span class="sc">$</span>cluster)) {</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  cluster_total <span class="ot">&lt;-</span> <span class="fu">sum</span>(tab[i, ]) <span class="co"># somme de la colonne correspondant au cluster i</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  points_bien_clusterises <span class="ot">&lt;-</span> tab[i, i] <span class="co"># nombre de points bien clusterisés pour le cluster i</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  pourcentage <span class="ot">&lt;-</span> points_bien_clusterises <span class="sc">/</span> cluster_total <span class="sc">*</span> <span class="dv">100</span> <span class="co"># calcul du pourcentage</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  pourcentages[i] <span class="ot">&lt;-</span> pourcentage <span class="co"># stockage du pourcentage dans le vecteur</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Pourcentage de points bien catégorisés pour chaque cluster:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pourcentages)){</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Dans le cluster"</span>,i,<span class="st">":"</span>,pourcentages[i],<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-16_225d744016414e8faf40945778927a6f">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Pourcentage de points bien catégorisés pour chaque cluster:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Dans le cluster 1 : 100 
Dans le cluster 2 : 100 
Dans le cluster 3 : 100 
Dans le cluster 4 : 100 
Dans le cluster 5 : 100 
Dans le cluster 6 : 100 
Dans le cluster 7 : 100 </code></pre>
</div>
</div>
<p>Avec cette méthode, l’ensemble des points sont correctement catégorisé.</p>
</section>
<section id="kmeans-kcentroïdes-vs-kmedoïdes" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="kmeans-kcentroïdes-vs-kmedoïdes"><span class="header-section-number">2.2.2</span> Kmeans: Kcentroïdes vs Kmedoïdes</h3>
Nous comparons les Kcentroïdes vs Kmedoïdes avec une intuition qu’avec les Kcentroïdes, un problème inhérent à son algorithme risque de se passer sur les deux clusters du bas.<br>
Pour les paramètres, nous gardons bien evidemment k=7, et nous utilisons nstart=10 pour avoir une stabilité du résultat final:
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>clust <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(Aggregation,<span class="dv">7</span>,<span class="at">nstart=</span> <span class="dv">10</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>Aggregation<span class="sc">$</span>cluster<span class="ot">&lt;-</span> <span class="fu">factor</span>(clust<span class="sc">$</span>cluster)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>centroide <span class="ot">&lt;-</span><span class="fu">ggplot</span>(Aggregation, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers), </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2), </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkred"</span>,<span class="at">size =</span> <span class="dv">6</span>,<span class="at">shape=</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="fu">unique</span>(clust<span class="sc">$</span>cluster),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Kmeans avec centroïdes:"</span>)<span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>clust<span class="ot">&lt;-</span> <span class="fu">pam</span>(Aggregation,<span class="dv">7</span>,<span class="at">stand =</span> <span class="cn">TRUE</span>,<span class="at">nstart =</span> <span class="dv">10</span>)  </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>Aggregation<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(clust<span class="sc">$</span>clustering)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>medoide <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Aggregation, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>medoids), </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2), </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkred"</span>,<span class="at">size =</span> <span class="dv">6</span>,<span class="at">shape=</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>medoids),</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2),</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Kmeans avec medoïdes:"</span>)<span class="sc">+</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>centroide<span class="sc">/</span>medoide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-18_4f95ff61c7dc36a35e4ec5780809ff86">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>La différence entre utilisation des k-centroïdes et des kmedoïdes reste assez mineure, le cluster 3 est séparé en deux avec les k-medoïdes mais n’est tout de même pas bien considéré.</p>
<p>L’algorithme kmeans et kmedoïdes a du mal à classifier les petits clusters qui sont proches de plus grand cluster, car la “masse” des plus gros cluster a tendance à attirer les centroïdes et medoïdes. De façon plus générale l’algorithme kmeans a du mâle à détecter des cluster qui ne sont pas de forme “circulaire/sphérique”.</p>
</section>
<section id="kmeans-clustering-spectral" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="kmeans-clustering-spectral"><span class="header-section-number">2.2.3</span> kmeans clustering spectral</h3>
<p>Afin de permettre au <code>kmeans</code>de mieux performer, nous allons transformer nos données en les segmentant à l’aide du clustering spectral. Il s’agit d’un algorithme de partitionnement des données reposant sur la théorie spectrale des graphes et l’algèbre linéaire.<br>
L’idée est de segmenter un graphe en plusieurs petits groupes ayant des valeurs similaires ou proches.</p>
<section id="algorithme-de-clustering-spectral" class="level4" data-number="2.2.3.1">
<h4 data-number="2.2.3.1" class="anchored" data-anchor-id="algorithme-de-clustering-spectral"><span class="header-section-number">2.2.3.1</span> <u>Algorithme de Clustering Spectral</u></h4>
<p>Données : Ensemble de points <span class="math inline">\(S = \{s_1, \ldots, s_n\}\)</span> dans <span class="math inline">\(\mathbb{R}^l\)</span>, nombre de clusters <span class="math inline">\(k\)</span></p>
<ol type="1">
<li><strong>Formation de la matrice d’affinité</strong> :
<ol type="a">
<li>Calculer la matrice d’affinité <span class="math inline">\(A\)</span> selon <span class="math inline">\(A_{ij} = \exp\left(-\frac{{||s_i - s_j||^2}}{{2 \sigma^2}}\right)\)</span></li>
</ol></li>
<li><strong>Construction de la matrice de degré et de la matrice Laplacienne normalisée</strong> :
<ol type="a">
<li>Calculer la matrice diagonale <span class="math inline">\(D\)</span> où <span class="math inline">\(D_{ii}\)</span> est la somme de la <span class="math inline">\(i\)</span>-ème ligne de <span class="math inline">\(A\)</span></li>
<li>Construire la matrice <span class="math inline">\(L = D^{-1/2} A D^{-1/2}\)</span></li>
</ol></li>
<li><strong>Calcul des vecteurs propres et formation de la matrice <span class="math inline">\(X\)</span></strong> :
<ol type="a">
<li>Trouver les <span class="math inline">\(k\)</span> plus grands vecteurs propres de <span class="math inline">\(L\)</span></li>
<li>Assurer l’orthogonalité des vecteurs propres en cas de valeurs propres répétées</li>
<li>Former la matrice <span class="math inline">\(X = [x_1, x_2, \ldots, x_k] \in \mathbb{R}^{n \times k}\)</span> en empilant les vecteurs propres</li>
</ol></li>
<li><strong>Formation de la matrice <span class="math inline">\(Y\)</span></strong> :
<ol type="a">
<li>Former la matrice <span class="math inline">\(Y\)</span> à partir de <span class="math inline">\(X\)</span> en normalisant chaque ligne de <span class="math inline">\(X\)</span> pour avoir une longueur unitaire : <span class="math inline">\(Y_{ij} = \frac{{X_{ij}}}{{\sqrt{\sum_j (X_{ij})^2}}}\)</span></li>
</ol></li>
<li><strong>Clustering des lignes de <span class="math inline">\(Y\)</span> via k-means</strong> :
<ol type="a">
<li>Utiliser k-means pour regrouper les lignes de <span class="math inline">\(Y\)</span> en <span class="math inline">\(k\)</span> clusters</li>
</ol></li>
<li><strong>Assignation des points d’origine aux clusters</strong> :
<ol type="a">
<li>Assigner chaque point d’origine <span class="math inline">\(s_i\)</span> au cluster <span class="math inline">\(j\)</span> si la ligne <span class="math inline">\(i\)</span> de <span class="math inline">\(Y\)</span> a été assignée au cluster <span class="math inline">\(j\)</span></li>
</ol></li>
</ol>
On applique cet algorithme sur notre jeu de données,avec comme clusters <span class="math inline">\(k=7\)</span> et comme ecart-type<br> <span class="math inline">\(\sigma\)</span>=<code>c(0.5,0.8,1,2)</code>:
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>spectral_clust<span class="ot">&lt;-</span> <span class="cf">function</span>(data,k,sigma){</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1: on construit la matrice adjacente qui qynthétise les relations entre tous les points de données du graphe.</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(proxy<span class="sc">::</span><span class="fu">dist</span>(data, <span class="cf">function</span>(si, sj) {<span class="fu">exp</span>(<span class="sc">-</span><span class="fu">sum</span>((si <span class="sc">-</span> sj)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> sigma<span class="sc">^</span><span class="dv">2</span>))}, <span class="at">auto_convert_data_frames =</span> <span class="cn">TRUE</span>))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2.1:on Calcul la matrice D qui calcul la somme des liens</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  diagonal <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(A)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  D <span class="ot">&lt;-</span> <span class="fu">diag</span>(diagonal)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2.2: on calcul a matrice laplacienne</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">sqrt</span>(D))<span class="sc">%*%</span>A<span class="sc">%*%</span><span class="fu">solve</span>(<span class="fu">sqrt</span>(D))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3.1: on recupère les valeurs et vecteurs propres</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  eigen_decomp <span class="ot">&lt;-</span> <span class="fu">eigen</span>(L,<span class="at">symmetric =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3.2: on construit la matrice X</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">=</span> eigen_decomp<span class="sc">$</span>vectors[,<span class="dv">1</span><span class="sc">:</span>k]</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4: on normalise la matrice X</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(X, <span class="dv">1</span>, <span class="cf">function</span>(row) row <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(row<span class="sc">^</span><span class="dv">2</span>))))</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 5: Application du kmeans sur la matrice Y</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(Y, <span class="at">centers =</span> k)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  cluster_labels <span class="ot">&lt;-</span> kmeans_result<span class="sc">$</span>cluster</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># on assigne nos points d'origine aux clusters</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  original_data_clusters <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(data))</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cluster_labels)) {</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    original_data_clusters[<span class="fu">which</span>(cluster_labels <span class="sc">==</span> i)] <span class="ot">&lt;-</span> i</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(original_data_clusters)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>Aggregation<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">spectral_clust</span>(Aggregation[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="dv">7</span>,<span class="fl">0.5</span>))</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Aggregation, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Kmeans avec clustering spectral"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-20_6035fe3125338d2f9bbacc9771691b65">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Cet algorithme plus complexe serait très utile pour du clustering plus poussé. Pour ce jeu de données, on retiendra la simplicité avec le <code>CAH</code> avec comme methode linkage <code>single</code>qui fonctionne très bien!</p>
</section>
</section>
</section>
<section id="flame" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="flame"><span class="header-section-number">2.3</span> Flame</h2>
<section id="cah-1" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="cah-1"><span class="header-section-number">2.3.1</span> CAH</h3>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>hclust <span class="ot">&lt;-</span> flashClust<span class="sc">::</span><span class="fu">flashClust</span>(<span class="fu">dist</span>(flame),<span class="at">method =</span> <span class="st">"ward"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hclust, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>flame<span class="sc">$</span>cluster <span class="ot">&lt;-</span> clusters</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flame, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> <span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"hclust"</span>)<span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(flame<span class="sc">$</span>cluster,flame<span class="sc">$</span>V3)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>pourcentages <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(<span class="fu">unique</span>(flame<span class="sc">$</span>cluster)))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(flame<span class="sc">$</span>cluster)) {</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  cluster_total <span class="ot">&lt;-</span> <span class="fu">sum</span>(tab[,i ])<span class="co"># somme de la colonne correspondant au cluster i</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  points_bien_clusterises <span class="ot">&lt;-</span> tab[i, i] <span class="co"># nombre de points bien clusterisés pour le cluster i</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  pourcentage <span class="ot">&lt;-</span> points_bien_clusterises <span class="sc">/</span> cluster_total <span class="sc">*</span> <span class="dv">100</span> <span class="co"># calcul du pourcentage</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  pourcentages[i] <span class="ot">&lt;-</span> pourcentage <span class="co"># stockage du pourcentage dans le vecteur</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Pourcentage de points bien catégorisés pour chaque cluster:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pourcentages)){</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Dans le cluster"</span>,i,<span class="st">":"</span>,<span class="fu">round</span>(pourcentages[i],<span class="dv">2</span>),<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-22_b8ed875b7de00a6250916718df84a76f">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Pourcentage de points bien catégorisés pour chaque cluster:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Dans le cluster 1 : 100 
Dans le cluster 2 : 70.59 </code></pre>
</div>
</div>
<p>L’algorithme n’arrive pas à bien trouver les deux clusters. On peut tenter de passer par des kmeans et des kmedoides en espérant un meilleur résultat.</p>
</section>
<section id="kmeans-1" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="kmeans-1"><span class="header-section-number">2.3.2</span> Kmeans</h3>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>clust <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(flame,<span class="dv">2</span>,<span class="at">nstart =</span> <span class="dv">10</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>flame<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(clust<span class="sc">$</span>cluster)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>centroide <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(flame, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers), </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2), </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkred"</span>,<span class="at">size =</span> <span class="dv">6</span>,<span class="at">shape=</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>centers),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Kmeans avec centroïdes:"</span>)<span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>clust<span class="ot">&lt;-</span> <span class="fu">pam</span>(flame,<span class="dv">2</span>,<span class="at">stand =</span> <span class="cn">TRUE</span>,<span class="at">nstart =</span> <span class="dv">10</span>)  </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>flame<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(clust<span class="sc">$</span>clustering)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>medoide <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(flame, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>medoids), </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2), </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkred"</span>,<span class="at">size =</span> <span class="dv">6</span>,<span class="at">shape=</span> <span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(clust<span class="sc">$</span>medoids),</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2),</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Kmeans avec medoïdes:"</span>)<span class="sc">+</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>centroide<span class="sc">/</span>medoide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-24_9cf80819dbd14b731f954267fc0eb4a2">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Très peu de différences au niveau des résultats de clustering entre les deux algorithmes pour ce jeu de donnée. On peut se tourner vers des techniques un peu plus complexe comme le DBscan ou le spectralclustering.</p>
</section>
<section id="dbscan" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="dbscan"><span class="header-section-number">2.3.3</span> DBscan</h3>
<p>DBSCAN (Density-Based Spatial Clustering of Applications with Noise) est un algorithme de clustering qui identifie des zones de densité élevée dans l’espace des données, délimitant ainsi des clusters de formes arbitraires, tout en distinguant les points isolés comme du bruit.<br>
Pour cela, on observe d’abord pour chaque point, le nombre de voisins à au plus une distance de <span class="math inline">\(\epsilon\)</span> de celui-ci. Si l’observation considérée possède un certains nombre de voisins (en la comprenant) fixé au préalable, il s’agit d’une observation <strong>coeur</strong>. ON regroupe ensuite toute observation au voisinage d’une observation coeur en les considérant en un cluster. Les observations qui ne sont ni au voisinage d’une observation coeur, ni coeur elle même, sont considéré comme des outliers.<br>
Il convient alors de définir trois éléments pour cet algorithme:</p>
<ul>
<li>la métrique utilisée pour calculer les voisinages: nous utliserons la distance euclidienne implémenté par défault dans la fonction <code>knn</code>.</li>
<li>le nombre de voisins nécessaire pour constituer une observation coeur. Nous pouvons faire varier cet argument avec au départ un nombre point minimal à trois au vu de notre jeu de données (2 outliers sont facilement visible à l’oeil).</li>
<li>la distance <span class="math inline">\(\epsilon\)</span> maximum entre voisins que nous définirons en visualisant les distances pour chaque observation de son voisin le plus proche.</li>
</ul>
Pour ce dernier argument, nous allons fixer <span class="math inline">\(\epsilon\)</span> tel qu’une part “sufisamment grande” des observations aient une distance à son plus proche voisin inférieure à <span class="math inline">\(\epsilon\)</span>. Pour cela nous affichons sur un graphique les distances triés des voisins de chaque observations puis nous utilisons la méthode du coude:
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>knn_dist <span class="ot">&lt;-</span> <span class="fu">knn.dist</span>(flame[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)], k)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>knn_dist_sorted <span class="ot">&lt;-</span> <span class="fu">apply</span>(knn_dist, <span class="dv">2</span>, sort)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>elbow <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">nrow</span>(flame))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(flame)) {</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  elbow[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(knn_dist_sorted[i, <span class="dv">2</span><span class="sc">:</span>k]) <span class="sc">/</span> (k <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>epsilon_90_percent <span class="ot">&lt;-</span> <span class="fu">quantile</span>(knn_dist_sorted[, k], <span class="fl">0.9</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(flame),<span class="at">y =</span> elbow),<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">"steelblue"</span>)<span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> epsilon_90_percent, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">nrow</span>(flame)<span class="sc">-</span><span class="dv">15</span>, <span class="at">y =</span> epsilon_90_percent, </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"ε ="</span>, <span class="fu">round</span>(epsilon_90_percent, <span class="dv">2</span>)), </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Points triés"</span>) <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Elbow Criterion"</span>) <span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
Avec cette méthode, on choisi un <span class="math inline">\(\epsilon\)</span> proche de 1.<br>
Il nous reste plus qu’à utiliser <code>dbscan</code> avec les arguments choisis et de visualiser graphiquement les clusters. COmme ce qui nous intéresse est d’avoir seulement 2 clusters, je n’affiche que les résultats qui ne font ressortir que deux clusters:
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>){</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  dbscan_result <span class="ot">&lt;-</span> <span class="fu">dbscan</span>(flame[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)], <span class="at">eps =</span><span class="fl">0.99</span>, <span class="at">minPts =</span> i,<span class="at">borderPoints =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  num_clusters <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(dbscan_result<span class="sc">$</span>cluster[dbscan_result<span class="sc">$</span>cluster <span class="sc">!=</span> <span class="dv">0</span>]))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(num_clusters<span class="sc">==</span><span class="dv">2</span>){</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    flame<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(dbscan_result<span class="sc">$</span>cluster)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    fig <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(flame, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"dbscan avec voisins minimum="</span>,i))</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(fig)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-28_4a65807704628a72dd5acbcdc42f4887">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Les points rouges (cluster 0) sont des <strong>outliers</strong>. Avec 6 voisins minimum, l’algorithme arrive assez bien à retranscrire les deux clusters même si 6 points sont considérés outliers aux bords des deux clusters.</p>
</section>
<section id="kmeans-avec-clustering-spectral" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="kmeans-avec-clustering-spectral"><span class="header-section-number">2.3.4</span> Kmeans avec clustering spectral</h3>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>flame<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">spectral_clust</span>(flame[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flame, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-30_8e911a8cc047137f48505d9d7764cc1c">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="spiral" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="spiral"><span class="header-section-number">2.4</span> Spiral</h2>
<section id="cah-2" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="cah-2"><span class="header-section-number">2.4.1</span> CAH</h3>
On fait le même choix que pour le jeu de données <code>Aggregation</code> en prenant comme distance la distance euclidienne et comme méthode de linkage <code>single</code>:
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>hclust <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(spiral),<span class="at">method =</span> <span class="st">"single"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_dend</span>(hclust,<span class="at">repel =</span> <span class="cn">TRUE</span>,<span class="at">k =</span> <span class="dv">7</span>,<span class="at">cex =</span> <span class="fl">0.5</span>,<span class="at">color_labels_by_k =</span> <span class="cn">FALSE</span>, <span class="at">rect =</span> <span class="cn">TRUE</span>)<span class="sc">+</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span>  <span class="st">"Dendogramme"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hclust, <span class="at">k =</span> <span class="dv">7</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>Aggregation<span class="sc">$</span>cluster <span class="ot">&lt;-</span> clusters</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Aggregation, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> <span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"CLustering avec Hclust"</span>)<span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(Aggregation<span class="sc">$</span>cluster,Aggregation<span class="sc">$</span>V3)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>pourcentages <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(<span class="fu">unique</span>(Aggregation<span class="sc">$</span>cluster))) <span class="co"># vecteur pour stocker les pourcentages</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(Aggregation<span class="sc">$</span>cluster)) {</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  cluster_total <span class="ot">&lt;-</span> <span class="fu">sum</span>(tab[i, ]) <span class="co"># somme de la colonne correspondant au cluster i</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  points_bien_clusterises <span class="ot">&lt;-</span> tab[i, i] <span class="co"># nombre de points bien clusterisés pour le cluster i</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  pourcentage <span class="ot">&lt;-</span> points_bien_clusterises <span class="sc">/</span> cluster_total <span class="sc">*</span> <span class="dv">100</span> <span class="co"># calcul du pourcentage</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  pourcentages[i] <span class="ot">&lt;-</span> pourcentage <span class="co"># stockage du pourcentage dans le vecteur</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Pourcentage de points bien catégorisés pour chaque cluster:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pourcentages)){</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Dans le cluster"</span>,i,<span class="st">":"</span>,pourcentages[i],<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-32_5f696a892b921270ab6b6a240509f8b6">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Pourcentage de points bien catégorisés pour chaque cluster:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Dans le cluster 1 : 100 
Dans le cluster 2 : 100 
Dans le cluster 3 : 100 </code></pre>
</div>
</div>
<p>L’algorithme arrive parfaitement a retrouver les bons clusters. On peut tout de même par curiosité tester le spectral clustering pour tenter de faire fonctionner les kmeans.</p>
</section>
<section id="kmeans-avec-clustering-spectral-1" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="kmeans-avec-clustering-spectral-1"><span class="header-section-number">2.4.2</span> Kmeans avec clustering spectral</h3>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec variance = 1 et 3 clusters</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>spiral<span class="sc">$</span>cluster <span class="ot">&lt;-</span><span class="fu">factor</span>(<span class="fu">spectral_clust</span>(spiral[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spiral, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="exercice-3-analyse-exporatoire" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> <u>Exercice 3: Analyse exporatoire</u></h1>
<section id="représentation-des-observations" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="représentation-des-observations"><span class="header-section-number">3.1</span> 1: représentation des observations</h2>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(meta,<span class="fu">aes</span>(<span class="at">x =</span> Gènes,<span class="at">fill=</span> Espèces))<span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Quantité"</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-37_0911ab5a9768388046406c6a6f2972d6">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="acp" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="acp"><span class="header-section-number">3.2</span> 2: ACP</h2>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>spectra<span class="sc">$</span>Gènes<span class="ot">&lt;-</span> meta<span class="sc">$</span>Gènes</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ACP_res <span class="ot">&lt;-</span> <span class="fu">PCA</span>(spectra,<span class="at">graph =</span> <span class="cn">FALSE</span>,<span class="at">quali.sup =</span> <span class="st">"Gènes"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>dim1 <span class="ot">&lt;-</span> <span class="fu">fviz_pca_ind</span>(ACP_res,<span class="at">habillage =</span> <span class="st">"Gènes"</span>,<span class="at">geom.ind =</span> <span class="st">"point"</span>,<span class="at">addEllipses =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Représention de l'ACP sur l'axe 1 et 2"</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>dim1</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>dim3 <span class="ot">&lt;-</span> <span class="fu">fviz_pca_ind</span>(ACP_res,<span class="at">habillage =</span> <span class="st">"Gènes"</span>,<span class="at">geom.ind =</span> <span class="st">"point"</span>,<span class="at">addEllipses =</span> <span class="cn">TRUE</span>,<span class="at">axes =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Représention de l'ACP sur l'axe 3 et 4"</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>dim3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-39_de5077dbf4af8f372144935fd3248d74">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-39-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On peut voir que sur la représentation sur l’axe 3 et 4, les points sont plus centrés autour des deux axes. On peut plus facilement visualiser des groupes entre les différents gènes.<br>
Malgré cela, la variance représenté par les quatres premières composantes reste dérisoire (15% de variance cumulée), on ne peut donc pas tirer grand chose de ces graphiques.</p>
</section>
<section id="clustering-hierarchique" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="clustering-hierarchique"><span class="header-section-number">3.3</span> 3: clustering hierarchique</h2>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>hclust <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(spectra),<span class="at">method =</span> <span class="st">"ward.D"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_dend</span>(hclust,<span class="at">repel =</span> <span class="cn">TRUE</span>,<span class="at">k =</span> <span class="dv">8</span>,<span class="at">cex =</span> <span class="fl">0.5</span>,<span class="at">color_labels_by_k =</span> <span class="cn">FALSE</span>, <span class="at">rect =</span> <span class="cn">TRUE</span>)<span class="sc">+</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title =</span>  <span class="st">"Dendogramme"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hclust, <span class="at">k =</span> <span class="dv">8</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>spectra<span class="sc">$</span>cluster <span class="ot">&lt;-</span> clusters</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(clusters,meta<span class="sc">$</span>Gènes)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.data.frame.table</span>(tab)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data) <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"clusters"</span>,<span class="st">"genes"</span>,<span class="st">"freq"</span>) </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> genes, <span class="at">y =</span> freq, <span class="at">fill =</span> <span class="fu">factor</span>(clusters))) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gènes"</span>, <span class="at">y =</span> <span class="st">"Quantité"</span>, <span class="at">fill =</span> <span class="st">"Clusters"</span>, <span class="at">title =</span> <span class="st">"Quantité par cluster en fonction des gènes:CAH"</span>) <span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-42_69529bddd3fa1a0d9e825a8182960008">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-42-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Résultat de la classification hiérarchique</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">4</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">5</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">6</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">7</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AUG</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">45</td>
</tr>
<tr class="even">
<td style="text-align: left;">EMD</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JNH</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">NYV</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">QBG</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">QWP</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RTO</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">VVJ</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>La stratégie “Ward” semble bien adapté et réussit à bien discriminer les clusters par gène (mis à part pour le gène <code>AUG</code> et <code>NYV</code>).<br>
Ces résultats sont tout à fait cohérent avec l’analyse en composantes principales sur les deux premières dimensions.</p>
</section>
<section id="kmeans-2" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="kmeans-2"><span class="header-section-number">3.4</span> 4: Kmeans</h2>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>kmeans <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(spectra[,<span class="sc">-</span><span class="fu">c</span>(<span class="fu">ncol</span>(spectra),<span class="fu">ncol</span>(spectra)<span class="sc">-</span><span class="dv">1</span>)],<span class="at">centers =</span> <span class="dv">8</span>,<span class="at">nstart=</span><span class="dv">10</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>spectra<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">as.character</span>(kmeans<span class="sc">$</span>cluster)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>cont <span class="ot">&lt;-</span> <span class="fu">table</span>(meta<span class="sc">$</span>Gènes,spectra<span class="sc">$</span>cluster)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(cont, <span class="at">caption =</span> <span class="st">"Résultat de la classification par kmeans"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisation des clusters</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.data.frame.table</span>(cont)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data) <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"genes"</span>,<span class="st">"clusters"</span>,<span class="st">"freq"</span>) </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> genes, <span class="at">y =</span> freq, <span class="at">fill =</span> <span class="fu">factor</span>(clusters))) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gènes"</span>, <span class="at">y =</span> <span class="st">"Quantité"</span>, <span class="at">fill =</span> <span class="st">"Clusters"</span>, <span class="at">title =</span> <span class="st">"Quantité par cluster en fonction des gènes: kmeans"</span>) <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-45_64ae5222cf5cd6fdee0339c348c5b7bd">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Résultat de la classification par kmeans</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">4</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">5</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">6</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">7</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AUG</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">70</td>
</tr>
<tr class="even">
<td style="text-align: left;">EMD</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JNH</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">NYV</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">QBG</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">QWP</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RTO</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">VVJ</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On peut remarquer que le clustering hiérarchique à une performance légèrement meilleure que le kmeans. Mais dans l’ensemble, les algorithmes semblent équivalents.</p>
</section>
<section id="identification-inter-espèce" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="identification-inter-espèce"><span class="header-section-number">3.5</span> 5: identification inter-espèce</h2>
<section id="gène-rto" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="gène-rto"><span class="header-section-number">3.5.1</span> Gène RTO</h3>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>spectra<span class="sc">$</span>espèces <span class="ot">&lt;-</span> meta<span class="sc">$</span>Espèces</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ACP <span class="ot">&lt;-</span> <span class="fu">PCA</span>(spectra[spectra<span class="sc">$</span>Gènes<span class="sc">==</span><span class="st">"RTO"</span>,],<span class="at">quali.sup =</span> <span class="fu">c</span>(<span class="st">"Gènes"</span>,<span class="st">"espèces"</span>,<span class="st">"cluster"</span>),<span class="at">graph =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_ind</span>(ACP,<span class="at">habillage =</span> <span class="st">"espèces"</span>,<span class="at">addEllipses =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Représentation ACP sur les composantes 1 et 2 du gène RTO"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Les observations des deux espèces s’entremêlent sur ce graphique ce qui ne permet pas une différenciation claire.</p>
</section>
<section id="kmeans-3" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="kmeans-3"><span class="header-section-number">3.5.2</span> Kmeans</h3>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> spectra[spectra<span class="sc">$</span>Gènes<span class="sc">==</span><span class="st">"RTO"</span>,]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(spectra)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>kmeans<span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data[,<span class="sc">-</span><span class="fu">c</span>(n,n<span class="dv">-1</span>,n<span class="dv">-2</span>)],<span class="dv">2</span>,<span class="at">nstart=</span><span class="dv">10</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>data_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">table</span>(data<span class="sc">$</span>espèces,kmeans<span class="sc">$</span>cluster))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(data_plot)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_plot) <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"especes"</span>,<span class="st">"clusters"</span>,<span class="st">"freq"</span>) </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_plot, <span class="fu">aes</span>(<span class="at">x =</span> especes, <span class="at">y =</span> freq, <span class="at">fill =</span> <span class="fu">factor</span>(clusters))) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Espèces"</span>, <span class="at">y =</span> <span class="st">"Quantité"</span>, <span class="at">fill =</span> <span class="st">"Clusters"</span>, <span class="at">title =</span> <span class="st">"Quantité par cluster en fonction des espèces: kmeans"</span>) <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Var1</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Var2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">RTO.JFR</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">RTO.TQH</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RTO.JFR</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">RTO.TQH</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>


</div>
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Il n’est pas possible avec un simple kmeans de discriminer parfaitement les deux espèces, il faudrait sûrement transformer nos données pour les visualiser sur plus de dimensions pour permettre une meilleure discrimination.</p>
</section>
<section id="gène-aug" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="gène-aug"><span class="header-section-number">3.5.3</span> Gène AUG</h3>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ACP <span class="ot">&lt;-</span> <span class="fu">PCA</span>(spectra[spectra<span class="sc">$</span>Gènes<span class="sc">==</span><span class="st">"AUG"</span>,],<span class="at">quali.sup =</span> <span class="fu">c</span>(<span class="st">"Gènes"</span>,<span class="st">"espèces"</span>,<span class="st">"cluster"</span>),<span class="at">graph =</span> <span class="cn">FALSE</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_ind</span>(ACP,<span class="at">habillage =</span> <span class="st">"espèces"</span>,<span class="at">addEllipses =</span> <span class="cn">TRUE</span>,<span class="at">geom.ind =</span> <span class="st">"point"</span>)<span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Représentation ACP sur les composantes 1 et 2 du gène AUG"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-52_7bd9746634fc6f4e4efe8e45d09ae748">
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On peut voir une nette séparation entre les observations des deux espèces.</p>
<details>
<summary style="font-weight: bold; color: #72afd2;">
Voir le code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> spectra[spectra<span class="sc">$</span>Gènes<span class="sc">==</span><span class="st">"AUG"</span>,]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(spectra)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>kmeans<span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data[,<span class="sc">-</span><span class="fu">c</span>(n,n<span class="dv">-1</span>,n<span class="dv">-2</span>)],<span class="dv">2</span>,<span class="at">nstart=</span><span class="dv">10</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>data_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">table</span>(data<span class="sc">$</span>espèces,kmeans<span class="sc">$</span>cluster))</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(data_plot)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_plot) <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"especes"</span>,<span class="st">"clusters"</span>,<span class="st">"freq"</span>) </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_plot, <span class="fu">aes</span>(<span class="at">x =</span> especes, <span class="at">y =</span> freq, <span class="at">fill =</span> <span class="fu">factor</span>(clusters))) <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Espèces"</span>, <span class="at">y =</span> <span class="st">"Quantité"</span>, <span class="at">fill =</span> <span class="st">"Clusters"</span>, <span class="at">title =</span> <span class="st">"Quantité par cluster en fonction des espèces: kmeans"</span>) <span class="sc">+</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="cell" data-hash="TP3_cache/html/unnamed-chunk-54_42a0879f800b2a7bf730cf801f32a70a">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Var1</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Var2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AUG.AEX</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUG.HSS</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AUG.AEX</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUG.HSS</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>


</div>
<div class="cell-output-display">
<p><img src="TP3_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>On voit également qu’avec un simple kmeans, on arrive à facilement discriminer les deux types d’espèces.</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>